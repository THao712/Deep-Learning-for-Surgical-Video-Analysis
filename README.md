# Deep-Learning-for-Surgical-Video-Analysis
åŸºäºæ·±åº¦å­¦ä¹ çš„æ‰‹æœ¯è§†é¢‘åˆ†æç®—æ³•


```markdown
# ğŸ§  Surgical Phase Anticipation Pipeline

> åŸºäº SegFormer + MS-TCN + Transformer çš„å¤šé˜¶æ®µæ‰‹æœ¯é˜¶æ®µé¢„æµ‹æ¨¡å‹è®­ç»ƒæ¡†æ¶

## ğŸ“ é¡¹ç›®ç»“æ„æ¦‚è§ˆ


code_80/
â”œâ”€â”€ train_evp.py            # ç¬¬ä¸€é˜¶æ®µï¼šä¸»å¹²ç½‘ç»œè®­ç»ƒ
â”œâ”€â”€ finetune_evp.py         # ç¬¬äºŒé˜¶æ®µï¼šä¸»å¹²ç½‘ç»œå¾®è°ƒ
â”œâ”€â”€ generate_evp_LFB.py     # ç‰¹å¾æå–ä¸å­˜å‚¨
â”œâ”€â”€ tecno.py                # MS-TCN è®­ç»ƒ
â”œâ”€â”€ tecno_trans.py          # Transformer è®­ç»ƒ
â””â”€â”€ trans_SV_output.py      # éªŒè¯/æµ‹è¯•é›†æ¨ç†é¢„æµ‹

data/cholec80/
â”œâ”€â”€ phase_anticipation_annotations/    # æ ‡æ³¨æ–‡ä»¶
â””â”€â”€ anticipation_output/               

bimask_ss_pos/cholec80/     # è®­ç»ƒç»“æœå­˜å‚¨
â”œâ”€â”€ stage1_32_8_40/         # ç¬¬ä¸€é˜¶æ®µç»“æœ
â”œâ”€â”€ stage2_40_40/           # ç¬¬äºŒé˜¶æ®µç»“æœ
â”‚   â”œâ”€â”€ embedding1/         # SegFormer å‚æ•°
â”‚   â”œâ”€â”€ LFB1/               # æå–çš„ç©ºé—´ç‰¹å¾
â”‚   â”œâ”€â”€ TeCNO1-2/           # MS-TCN æ¨¡å‹å‚æ•°
â”‚   â”œâ”€â”€ TeCNOt1-2/          # Transformer æ¨¡å‹å‚æ•°
â”‚   â””â”€â”€ output/             # é¢„æµ‹ç»“æœ
â””â”€â”€ runs/                   # TensorBoard æ—¥å¿—

```
## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
è®­ç»ƒå‰ï¼Œåˆ‡æ¢åˆ°æˆ‘ä»¬è¦ç”¨çš„ç¯å¢ƒï¼Œpycharmè¿æ¥å¥½æœåŠ¡å™¨ååœ¨ç”µè„‘pycharmè½¯ä»¶-ç»ˆç«¯-æœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦è¿æ¥æœåŠ¡å™¨ï¼Œè¦è¿çš„æ—¶å€™å’Œæˆ‘ï¼ˆä½Ÿï¼‰è¯´ï¼ˆå‡ ä¹ç”¨ä¸åˆ°ï¼Œä¸€èˆ¬è°ƒè¯•æ˜¯åœ¨æœ¬åœ°è·‘ï¼Œç”¨æœåŠ¡å™¨æ˜¯è°ƒè¯•æ²¡é—®é¢˜çš„æ—¶å€™ï¼‰
my_srtp_envæ˜¯æˆ‘ä»¬autodlæœåŠ¡å™¨ä¸Šé…å¥½çš„ç¯å¢ƒ
```bash
conda activate my_srtp_env
```

### 2. ä¸»å¹²ç½‘ç»œè®­ç»ƒï¼ˆä¸¤é˜¶æ®µï¼‰
æ¿€æ´»ä¸Šé¢çš„ç¯å¢ƒåæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š
#### ç¬¬ä¸€é˜¶æ®µè®­ç»ƒ
```bash
cd /root/autodl-tmp/data/code_80
```
```bash
nohup python train_evp.py > train_log.txt 2>&1 &
```
#### æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
```bash
tail -f train_log.txt
```
æŒ‰Ctrl+cå¯ä»¥é€€å‡ºæŸ¥çœ‹æ¨¡å¼

ç»ˆæ­¢æœåŠ¡å™¨ä¸Šçš„ä»£ç è¿è¡Œï¼šæœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œï¼š
```bash
nvidia-smi
```
æŸ¥çœ‹PIDï¼Œæ‰§è¡Œkill PID(æ•°å­—)

#### ç¬¬äºŒé˜¶æ®µå¾®è°ƒï¼ˆæ‰€æœ‰çš„å‘½ä»¤åŸºæœ¬éƒ½æ˜¯åœ¨code_80ç›®å½•ä¸‹æ‰§è¡Œï¼Œå³æ‰§è¡Œcd /root/autodl-tmp/data/code_80ï¼‰
```bash
nohup python finetune_evp.py > finetune_log.txt 2>&1 &
```

#### æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
```bash
tail -f finetune_log.txt
# æŒ‰ Ctrl+C é€€å‡ºæŸ¥çœ‹
```
#### TensorBoardæŸ¥çœ‹
ä»æœåŠ¡å™¨æŠŠè®­ç»ƒç»“æœä¸‹è½½åˆ°æœ¬åœ°ï¼ˆè¿è¡Œrunsæ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ï¼Œé€‰ä¸­runsæ–‡ä»¶å¤¹å³å¯ï¼Œä¸è¦ç®¡æ˜¯æ–‡ä»¶å¤¹ä¸‹çš„å“ªä¸ªæ–‡ä»¶ï¼Œç›®å‰åªèƒ½æˆ‘æ¥åšï¼Œæˆ‘ä¼šåœ¨è®­ç»ƒå®Œä¹‹åä¸Šä¼ åˆ°æˆ‘ä»¬çš„githubï¼‰ï¼Œæ‰§è¡Œï¼š
```bash
tensorboard --logdir="D:\srtp\dataset\code_80\bimask_ss_pos\cholec80\stage1_32_8_40\embedding1\runs"
```
ï¼ˆæŸ¥çœ‹å…¶ä»–ä»£ç çš„è¿è¡Œæ—¥å¿—æ—¶æ›´æ”¹runsæ–‡ä»¶å¤¹çš„è·¯å¾„å³å¯ï¼Œæ¯ä¸ªè®­ç»ƒé˜¶æ®µéƒ½ä¼šæœ‰ä¸ªrunsæ–‡ä»¶å¤¹äº§ç”Ÿï¼Œç”¨æ¥æ£€æµ‹æŸå¤±ã€å‡†ç¡®ç‡ç­‰æŒ‡æ ‡çš„å˜åŒ–ï¼Œå…·ä½“è·¯å¾„æ ¹æ®è‡ªå·±ç”µè„‘ä¸Šçš„è·¯å¾„å»æ›´æ”¹ï¼Œåœ¨æœ¬åœ°çš„ç¯å¢ƒè¿è¡Œï¼Œåº”è¯¥éƒ½é…å¥½äº†å§ï¼ˆï¼‰ï¼‰

ä¸€ã€äºŒé˜¶æ®µè®­ç»ƒæ˜¯ä¸ºäº†è®­ç»ƒæˆ‘ä»¬çš„ä¸»å¹²ç½‘ç»œå³SegFormerçš„å‚æ•°ï¼Œä½œä¸ºç‰¹å¾æå–å™¨

### 3. ç‰¹å¾æå–
ä½¿ç”¨è®­ç»ƒå¥½çš„ SegFormer æå–ç‰¹å¾ï¼Œæ³¨æ„ä¹Ÿè¦åœ¨æœåŠ¡å™¨çš„code_80ç›®å½•ä¸‹æ‰§è¡Œï¼š

```bash
nohup python generate_evp_LFB.py > generate_LFB_log.txt 2>&1 &
```
```bash
tail -f generate_LFB_log.txt
```
è¿™ä¸ªä¸»è¦æ˜¯ç”¨è®­ç»ƒå¥½çš„SegFormeræå–ç‰¹å¾å¹¶å­˜å‚¨ï¼Œç”¨äºåç»­çš„MS-TCNï¼ŒTransFormeræ¨¡å‹å‚æ•°è®­ç»ƒã€ä»¥åŠç”¨è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹éªŒè¯é›†å’Œæµ‹è¯•é›†ä½œé¢„æµ‹

### 4. æ—¶åºæ¨¡å‹è®­ç»ƒ
è¿™ä¸ªæ–‡ä»¶è´Ÿè´£è®­ç»ƒMS-TCNçš„å‚æ•°ï¼šéšæœºåˆå§‹åŒ–å‚æ•°åï¼Œä½¿ç”¨generate_evp_LFBæå–å¥½çš„ç‰¹å¾è¿›è¡Œå‚æ•°è®­ç»ƒä¸ä¼˜åŒ–ï¼Œå¾—åˆ°è®­ç»ƒå¥½çš„MS-TCNæ¨¡å‹ï¼Œ.pthå°±æ˜¯å®ƒçš„å‚æ•°æ–‡ä»¶

#### MS-TCN è®­ç»ƒ
```bash
nohup python tecno.py > tecno_log.txt 2>&1 &
```
```bash
tail -f tecno_log.txt
```

#### Transformer è®­ç»ƒ

è¿™ä¸ªæ–‡ä»¶æ˜¯è®­ç»ƒTransformerçš„å‚æ•°ï¼Œå…ˆç”¨è®­ç»ƒå¥½çš„MS-TCNæ¨¡å‹ï¼Œå¯¹generate_evp_LFBæå–å¥½çš„ç©ºé—´ç‰¹å¾å†æå–æ—¶åºç‰¹å¾ï¼Œç„¶åä¸ç©ºé—´ç‰¹å¾ä¸€èµ·è¾“å…¥Transformerè¿›è¡Œå‚æ•°è®­ç»ƒä¸ä¼˜åŒ–ï¼Œå¾—åˆ°è®­ç»ƒå¥½çš„Transformeræ¨¡å‹ï¼Œ.pthä¸ºå…¶å‚æ•°æ–‡ä»¶

```bash
nohup python tecno_trans.py > tecno_trans_log.txt 2>&1 &
```
```bash
tail -f tecno_trans_log.txt
```

### 5. æ¨ç†é¢„æµ‹
è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆMS-TCNå’ŒTransformerï¼‰å¯¹éªŒè¯é›†å’Œæµ‹è¯•é›†ä½œé¢„æµ‹ï¼Œå¾—åˆ°ç»“æœï¼Œå…¶è¾“å…¥æ˜¯generate_evp_LFB.pyæå–çš„ç©ºé—´ç‰¹å¾ã€ä¸¤ä¸ªæ¨¡å‹çš„å‚æ•°æ–‡ä»¶ï¼ŒåŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼š

```bash
nohup python trans_SV_output.py > trans_SV_output_log.txt 2>&1 &
```
```bash
tail -f trans_SV_output_log.txt
```
ä¸‹é¢æ˜¯æ¨¡å‹åŠ è½½ç¤ºä¾‹(`trans_SV_output.py)ï¼Œtecno.pyå’Œtecno_trans.pyéƒ½æ˜¯ç±»ä¼¼çš„
```bash
model = mstcn.MultiStageModel_S(mstcn_stages, mstcn_layers, mstcn_f_maps, mstcn_f_dim, out_features, mstcn_causal_conv)
model_path = 'bimask_ss_pos/cholec80/stage2_40_40/TeCNO1-2/'
model_name = 'TeCNOevp_epoch_15'
model.load_state_dict(torch.load(model_path + model_name + '.pth'))è¿™æ®µä»£ç è´Ÿè´£åŠ è½½MS-TCNçš„å‚æ•°ï¼Œ.pthæ–‡ä»¶ä¸ºæœ€å¥½çš„epochå¯¹åº”çš„å‚æ•°æ–‡ä»¶

model1 = Transformer(mstcn_f_maps, mstcn_f_dim, out_features, sequence_length)
model1_path = 'bimask_ss_pos/cholec80/stage2_40_40/TeCNO_t1-2/'
model1_name = 'TeCNOevp_trans1_3_5_1_length_30_epoch_1_train_9780_val_9210.pth'  
model1.load_state_dict(torch.load(model1_path + model1_name))è¿™æ®µä»£ç è´Ÿè´£åŠ è½½Transformeræ¨¡å‹çš„å‚æ•°ï¼Œ.pthæ–‡ä»¶ä¸ºæœ€å¥½çš„epochå¯¹åº”çš„å‚æ•°æ–‡ä»¶
```
åŠ è½½å¥½ä¹‹åå°±å¯ä»¥æ‰§è¡Œä»£ç ä½œé¢„æµ‹äº†ï¼Œç›®å‰æˆ‘ä»¬å°±å®Œæˆäº†ä»‡å­¦å§ESIPçš„å¤ç°ï¼Œåç»­æˆ‘ä»¬åŠ å…‰æµçš„æ—¶å€™è¦é‡æ¥ä¸€éæµç¨‹ï¼Œæ¯æ¬¡è®­ç»ƒå¾—åˆ°ä¸€ä¸ªæœ€å¥½çš„epochåï¼Œåç»­ä»£ç çš„æ‰§è¡Œéƒ½è¦æ³¨æ„ä¿®æ”¹å‚æ•°çš„åŠ è½½è·¯å¾„


## ğŸ› ï¸ è®­ç»ƒæµç¨‹è¯¦è§£

### ğŸ“Š æµç¨‹æ¦‚è§ˆ

```mermaid
graph TD
    A[ç¬¬ä¸€é˜¶æ®µè®­ç»ƒ<br>SegFormer] --> B[ç¬¬äºŒé˜¶æ®µå¾®è°ƒ<br>SegFormer]
    B --> C[ç‰¹å¾æå–<br>generate_evp_LFB.py]
    C --> D[MS-TCNè®­ç»ƒ<br>tecno.py]
    D --> E[Transformerè®­ç»ƒ<br>tecno_trans.py]
    E --> F[æ¨ç†é¢„æµ‹<br>trans_SV_output.py]
    F --> G[è¾“å‡ºé¢„æµ‹ç»“æœ]
```

### ä¸€ã€ä¸»å¹²ç½‘ç»œè®­ç»ƒï¼ˆSegFormerï¼‰

**ç›®æ ‡**ï¼šè®­ç»ƒ SegFormer ä½œä¸ºç‰¹å¾æå–å™¨

- **ç¬¬ä¸€é˜¶æ®µ**ï¼šåŸºç¡€è®­ç»ƒ
- **ç¬¬äºŒé˜¶æ®µ**ï¼šå¾®è°ƒä¼˜åŒ–
- **è¾“å‡ºä½ç½®**ï¼š`bimask_ss_pos/cholec80/stage1_32_8_40/embedding1/`ã€`bimask_ss_pos/cholec80/stage2_40_40/embedding1/`

### äºŒã€ç‰¹å¾æå–

**æ–‡ä»¶**ï¼š`generate_evp_LFB.py`

**åŠŸèƒ½**ï¼šä½¿ç”¨è®­ç»ƒå¥½çš„ SegFormer æå–è§†é¢‘çš„ç©ºé—´ç‰¹å¾å¹¶å­˜å‚¨ï¼Œä¾›åç»­æ—¶åºæ¨¡å‹ä½¿ç”¨ã€‚

### ä¸‰ã€æ—¶åºæ¨¡å‹è®­ç»ƒ

#### 1. MS-TCN è®­ç»ƒ
- **æ–‡ä»¶**ï¼š`tecno.py`
- **è¾“å…¥**ï¼šæå–çš„ç©ºé—´ç‰¹å¾
- **è¾“å‡º**ï¼šMS-TCN æ¨¡å‹å‚æ•°ï¼ˆ`.pth` æ–‡ä»¶ï¼‰
- **å¤ç°é˜¶æ®µè¾“å‡ºçš„æœ€å¥½è½®æ¬¡(epoch)ï¼Œå³æœ€ä½³å‚æ•°**ï¼š`TeCNOevp_epoch_15.pth`

#### 2. Transformer è®­ç»ƒ
- **æ–‡ä»¶**ï¼š`tecno_trans.py`
- **è¾“å…¥**ï¼šç©ºé—´ç‰¹å¾ + MS-TCN æ¨¡å‹æå–çš„æ—¶åºç‰¹å¾ï¼ˆåŠ è½½tecno.pyè®­ç»ƒå‡ºçš„å‚æ•°ï¼‰
- **è¾“å‡º**ï¼šTransformer æ¨¡å‹å‚æ•°ï¼ˆ`.pth` æ–‡ä»¶ï¼‰
- **å¤ç°é˜¶æ®µè¾“å‡ºçš„æœ€å¥½è½®æ¬¡(epoch)**ï¼š`TeCNOevp_trans1_3_5_1_length_30_epoch_1_train_9780_val_9210.pth`

### å››ã€æ¨ç†é¢„æµ‹

**æ–‡ä»¶**ï¼š`trans_SV_output.py`

**åŠŸèƒ½**ï¼šåŠ è½½è®­ç»ƒå¥½çš„ MS-TCN å’Œ Transformer æ¨¡å‹ï¼Œå¯¹éªŒè¯é›†å’Œæµ‹è¯•é›†è¿›è¡Œé¢„æµ‹ï¼Œç”Ÿæˆæœ€ç»ˆç»“æœï¼Œä¿å­˜åœ¨code_80\bimask_ss_pos\cholec80\stage2_40_40\outputä¸­ã€‚

## ğŸ“‚ æ•°æ®ä¸æ ‡æ³¨è¯´æ˜

### æ ‡æ³¨æ–‡ä»¶æ ¼å¼
`data/cholec80/phase_anticipation_annotations/`

- **æ ¼å¼**ï¼šäºŒç»´çŸ©é˜µ
- **è¡Œ**ï¼šè§†é¢‘çš„æ¯ä¸€å¸§ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰
- **åˆ—**ï¼š7ä¸ªæ‰‹æœ¯é˜¶æ®µ
- **æ•°å€¼å«ä¹‰**ï¼š
  - `0`ï¼šå½“å‰æ­£åœ¨è¿›è¡Œè¯¥é˜¶æ®µ
  - `>0`ï¼šå½’ä¸€åŒ–åçš„å€’è®¡æ—¶æ•°å€¼ï¼ˆ0~1ï¼‰ï¼Œè¡¨ç¤ºè·ç¦»è¯¥é˜¶æ®µå‘ç”Ÿçš„æ—¶é—´ï¼Œæ•°å€¼è¶Šå¤§åˆ™ç¦»è¿™ä¸ªé˜¶æ®µè¶Šè¿œï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä½ ä»¬æ–‡ä»¶å¤¹é‡Œçš„txtæ–‡ä»¶ï¼Œåœ¨pycharmæ‰“å¼€æ›´å¥½çœ‹ï¼Œ1è¡¨ç¤ºæœ€è¿œè·ç¦»ï¼Œå³ä»‡å­¦å§è§„å®šçš„5åˆ†é’Ÿï¼Œæˆ‘ä»¬ä¸ç”¨æ”¹åŠ¨

### è¾“å‡ºå¯è§†åŒ–
`data/cholec80/anticipation_output/`

- **å†…å®¹**ï¼šåŒ…å«7ä¸ªå­å›¾çš„å¤§å›¾ï¼Œæ¯ä¸ªå­å›¾å¯¹åº”ä¸€ä¸ªæ‰‹æœ¯é˜¶æ®µ
- **Xè½´**ï¼šå¸§æ•°ï¼ˆæ—¶é—´ï¼‰
- **Yè½´**ï¼šè·ç¦»ä¸‹ä¸€é˜¶æ®µå‘ç”Ÿçš„æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
- **çº¢è‰²æ›²çº¿**ï¼šGround Truth ä¿¡å·ï¼ˆé”¯é½¿çŠ¶æ³¢å½¢ï¼‰

## ğŸ”§ ç›‘æ§ä¸è°ƒè¯•

### TensorBoard å¯è§†åŒ–
ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­
```bash
tensorboard --logdir="D:\srtp\dataset\code_80\bimask_ss_pos\cholec80\stage1_32_8_40\embedding1\runs"
```

> **æ³¨æ„**ï¼šè·¯å¾„éœ€æ ¹æ®æœ¬åœ°å®é™…æƒ…å†µè°ƒæ•´ï¼Œåœ¨æœ¬åœ°å·²é…ç½®å¥½çš„ç¯å¢ƒä¸­è¿è¡Œï¼ˆå¤§å®¶åº”è¯¥éƒ½é…å¥½äº†å§ï¼Œä¸èƒ½è¿è¡Œçš„è¯å°±æ£€æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰è£…tensorboardåº“ï¼Œæ²¡è£…çš„è¯æŠ¥é”™çš„æ—¶å€™ä¹Ÿä¼šæç¤ºçš„ï¼‰

### ç»ˆæ­¢è®­ç»ƒè¿›ç¨‹
1. æŸ¥çœ‹ GPU è¿›ç¨‹ï¼šæœåŠ¡å™¨ç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤
```bash
nvidia-smi
```
2. æ‰§è¡Œä¸Šè¿°å‘½ä»¤åä¼šå¾—åˆ°ä¸€ä¸ªæ–¹æ¡†ï¼Œæ‰¾PIDï¼Œæ ¹æ®æ˜¾ç¤ºçš„ PID ç»ˆæ­¢è¿›ç¨‹ï¼š
```bash
kill <PID>
```

## ğŸ“Š æ¨¡å‹æ–‡ä»¶è¯´æ˜

| ç›®å½•/æ–‡ä»¶ | è¯´æ˜ |
|-----------|------|
| `stage1_32_8_40/` | ç¬¬ä¸€é˜¶æ®µè®­ç»ƒç»“æœ |
| `stage2_40_40/` | ç¬¬äºŒé˜¶æ®µè®­ç»ƒç»“æœ |
| `embedding1/` | SegFormer æ¨¡å‹å‚æ•° |
| `LFB1/` | æå–çš„ç©ºé—´ç‰¹å¾æ•°æ® |
| `TeCNO1-2/` | MS-TCN æ¨¡å‹å‚æ•° |
| `TeCNOt1-2/` | Transformer æ¨¡å‹å‚æ•° |
| `output/` | éªŒè¯é›†å’Œæµ‹è¯•é›†çš„é¢„æµ‹ç»“æœ |

## ğŸ”— å„è„šæœ¬å…³ç³»è¯¦è§£

### 1. `tecno.py` - ç¬¬ä¸€é˜¶æ®µè®­ç»ƒå™¨
- **è§’è‰²**ï¼šè®­ç»ƒåŸºç¡€çš„ MS-TCN æ¨¡å‹
- **è¾“å…¥**ï¼šé¢„æå–çš„è§†é¢‘ç‰¹å¾ï¼ˆLFB featuresï¼‰
- **è¾“å‡º**ï¼šMS-TCN æ¨¡å‹æƒé‡æ–‡ä»¶
- **å…³é”®ç‚¹**ï¼šè¿™æ˜¯æ•´ä¸ªæµæ°´çº¿çš„åœ°åŸºï¼Œä¸ä¾èµ–å…¶ä»–æ¨¡å‹æ–‡ä»¶

### 2. `tecno_trans.py` - ç¬¬äºŒé˜¶æ®µè®­ç»ƒå™¨
- **è§’è‰²**ï¼šè®­ç»ƒ Transformer æ¨¡å‹
- **è¾“å…¥**ï¼šè§†é¢‘ç‰¹å¾ + MS-TCN çš„è¾“å‡º
- **ä¾èµ–**ï¼šéœ€è¦å…ˆè®­ç»ƒå¥½ `tecno.py` ç”Ÿæˆçš„ MS-TCN æ¨¡å‹
- **è¾“å‡º**ï¼šTransformer æ¨¡å‹æƒé‡æ–‡ä»¶

### 3. `trans_SV_output.py` - æ¨ç†ç”Ÿæˆå™¨
- **è§’è‰²**ï¼šåŠ è½½å®Œæ•´æ¨¡å‹è¿›è¡Œé¢„æµ‹
- **è¾“å…¥**ï¼šè§†é¢‘ç‰¹å¾ + MS-TCN æƒé‡ + Transformer æƒé‡
- **ä¾èµ–**ï¼šéœ€è¦å‰ä¸¤ä¸ªé˜¶æ®µè®­ç»ƒå¥½çš„æ¨¡å‹
- **è¾“å‡º**ï¼šæœ€ç»ˆçš„é¢„æµ‹ç»“æœæ–‡ä»¶

## ğŸ“ ä»£ç ç¤ºä¾‹

### æ¨¡å‹åŠ è½½ç¤ºä¾‹(trans_SV_output.py)ï¼Œtecno.pyå’Œtecno_trans.pyéƒ½æ˜¯ç±»ä¼¼çš„
```python
# åŠ è½½ MS-TCN å‚æ•°
model = mstcn.MultiStageModel_S(mstcn_stages, mstcn_layers, mstcn_f_maps, 
                                mstcn_f_dim, out_features, mstcn_causal_conv)
model_path = 'bimask_ss_pos/cholec80/stage2_40_40/TeCNO1-2/'
model_name = 'TeCNOevp_epoch_15'
model.load_state_dict(torch.load(model_path + model_name + '.pth'))

# åŠ è½½ Transformer å‚æ•°
model1 = Transformer(mstcn_f_maps, mstcn_f_dim, out_features, sequence_length)
model1_path = 'bimask_ss_pos/cholec80/stage2_40_40/TeCNO_t1-2/'
model1_name = 'TeCNOevp_trans1_3_5_1_length_30_epoch_1_train_9780_val_9210.pth'
model1.load_state_dict(torch.load(model1_path + model1_name))
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è®­ç»ƒé¡ºåº**ï¼šå¿…é¡»æŒ‰ç…§ `ä¸»å¹²ç½‘ç»œ â†’ ç‰¹å¾æå– â†’ MS-TCN â†’ Transformer â†’ æ¨ç†` çš„é¡ºåºæ‰§è¡Œ
2. **ç¯å¢ƒé…ç½®**ï¼šç¡®ä¿åœ¨æ­£ç¡®çš„ conda ç¯å¢ƒä¸­è¿è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œè¿è¡Œçš„æ—¶å€™åŒºåˆ†ä¸€ä¸‹æœ¬åœ°å’ŒæœåŠ¡å™¨ï¼Œä¸€èˆ¬æ¥è¯´æœåŠ¡å™¨æ‰§è¡Œçš„è¯æ˜¯åœ¨æˆ‘è¿™é‡Œå¼„ï¼Œä½ ä»¬æœ‰å…´è¶£çš„è¯å¯ä»¥å­¦å­¦æ€ä¹ˆè¿æ¥æœåŠ¡å™¨
3. **è·¯å¾„é€‚é…**ï¼šTensorBoard è·¯å¾„å’Œæ¨¡å‹åŠ è½½è·¯å¾„éœ€æ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´
4. **æ—¥å¿—ç›‘æ§**ï¼šä½¿ç”¨ `tail -f` å‘½ä»¤å®æ—¶ç›‘æ§è®­ç»ƒè¿›åº¦
5. **æ¨¡å‹é€‰æ‹©**ï¼šé€‰æ‹©éªŒè¯é›†æ€§èƒ½æœ€å¥½çš„ epoch å¯¹åº”çš„æ¨¡å‹æ–‡ä»¶è¿›è¡Œåç»­è®­ç»ƒå’Œæ¨ç†

